##
## SPDX-FileCopyrightText: 2021 Splunk, Inc. <sales@splunk.com>
## SPDX-License-Identifier: LicenseRef-Splunk-8-2021
##
##
[source::...*ta_symantec-ep.log]
EVENT_BREAKER_ENABLE = true
sourcetype = ta_symantec-ep

[symantec:ep:syslog]
TRANSFORMS-sub_sourcetype_sep = force_sourcetype_sep_scm_system, force_sourcetype_sep_agent, force_sourcetype_sep_admin, force_sourcetype_sep_policy, force_sourcetype_sep_behavior, force_sourcetype_sep_scan, force_sourcetype_sep_security, force_sourcetype_sep_traffic, force_sourcetype_sep_packet, force_sourcetype_sep_agt_system, force_sourcetype_sep_risk, force_sourcetype_sep_proactive
pulldown_type = true
category = Network & Security
description = Symantec Endpoint Protection via syslog
MAX_TIMESTAMP_LOOKAHEAD = 32
SHOULD_LINEMERGE = false
EVENT_BREAKER_ENABLE = true

[symantec:ep:agt_system:file]
TRANSFORMS-nullqueueheader = sep_file_header
KV_MODE = none
pulldown_type = true
category = Network & Security
description = Symantec Endpoint Protection client agent system events
MAX_TIMESTAMP_LOOKAHEAD = 32
SHOULD_LINEMERGE = false
EVENT_BREAKER_ENABLE = true

REPORT-field_extraction_for_agt_system = field_extraction_for_agt_system,field_extraction_action,field_extraction_status_2,field_extract_event_description,field_extract_event_time,field_exctraction_file_name_file_path,field_exctraction_file_size,field_exctraction_ip_and_mac

FIELDALIAS-dest = Host_Name as dest
FIELDALIAS-dvc = Host_Name as dvc
FIELDALIAS-object = Host_Name as object
FIELDALIAS-body = description as body
FIELDALIAS-service = Event_Source as service
FIELDALIAS-service_name = Event_Source as service_name
FIELDALIAS-file_access_time = event_time as file_access_time
EVAL-user = coalesce(user, Group_Name)

# Purpose for below "EVAL": trim ' or " or key from field value.
EVAL-Event_Description = nullif(replace(if(match(Event_Description, "^\".*"), trim(Event_Description, "\""), if(match(Event_Description, "^\'.*"), trim(Event_Description, "\'"), Event_Description)), "Event Description:\s*", ""), "")
EVAL-severity = case(Category=0, "informational", Category=1, "low", Category=2, "medium", Category=3, "high", Category>=4, "critical")
EVAL-event_action = lower(event_action)
EVAL-result = if(lower(event_status) == "failed", "failure", description)
EVAL-status = if(lower(event_status) == "failed", "failure", "success")
EVAL-app = "Symantec"
EVAL-vendor_product = "Symantec Endpoint Protection"

LOOKUP-cim_data_model = symantec_ep_data_model_lookup_340 event_description as Event_Description OUTPUT cim_data_model, dataset
LOOKUP-admin_action = symantec_ep_change_action_lookup_340 event_action OUTPUTNEW action
LOOKUP-change_fields = symantec_ep_change_data_model_fields_lookup vendor_action as Event_Description OUTPUTNEW change_type, object_category
LOOKUP-object_category = symantec_ep_change_data_model_fields_lookup vendor_action as Event_Description OUTPUTNEW change_type, object_category
LOOKUP-alert_type = symantec_ep_alert_type_lookup_340 description as Event_Description OUTPUTNEW type

[symantec:ep:agt:system:syslog]
# Copied field extraction from symantec:ep:agt_system:file sourcetype
KV_MODE = none
pulldown_type = true
category = Network & Security
description = Symantec Endpoint Protection client agent system events
REPORT-field_extraction_for_agt_system = field_extraction_for_agt_system,field_extraction_action,field_extraction_status_2,field_extract_event_description,field_exctraction_file_name_file_path,field_exctraction_file_size,field_exctraction_ip_and_mac

FIELDALIAS-dest = Host_Name as dest
FIELDALIAS-dvc = Host_Name as dvc
FIELDALIAS-object = Host_Name as object
FIELDALIAS-body = description as body
FIELDALIAS-service = Event_Source as service
FIELDALIAS-service_name = Event_Source as service_name
FIELDALIAS-file_access_time = Event_Time as file_access_time
FIELDALIAS-user = Group_Name as user

# Purpose for below "EVAL": trim ' or " or key from field value.
EVAL-Event_Description = nullif(replace(if(match(Event_Description, "^\".*"), trim(Event_Description, "\""), if(match(Event_Description, "^\'.*"), trim(Event_Description, "\'"), Event_Description)), "Event Description:\s*", ""), "")
EVAL-severity = case(Category=0, "informational", Category=1, "low", Category=2, "medium", Category=3, "high", Category>=4, "critical")
EVAL-event_action = lower(event_action)
EVAL-result = if(lower(event_status) == "failed", "failure", description)
EVAL-status = if(lower(event_status) == "failed", "failure", "success")
EVAL-app = "Symantec"
EVAL-vendor_product = "Symantec Endpoint Protection"

LOOKUP-cim_data_model = symantec_ep_data_model_lookup_340 event_description as Event_Description OUTPUT cim_data_model, dataset
LOOKUP-admin_action = symantec_ep_change_action_lookup_340 event_action OUTPUTNEW action
LOOKUP-change_fields = symantec_ep_change_data_model_fields_lookup vendor_action as Event_Description OUTPUTNEW change_type, object_category
LOOKUP-alert_type = symantec_ep_alert_type_lookup_340 description as Event_Description OUTPUTNEW type
LOOKUP-object_category = symantec_ep_change_data_model_fields_lookup vendor_action as Event_Description OUTPUTNEW object_category

[symantec:ep:scm_system:file]
TRANSFORMS-nullqueueheader = sep_file_header
KV_MODE = none
pulldown_type = true
category = Network & Security
description = Symantec Endpoint Protection server system events
MAX_TIMESTAMP_LOOKAHEAD = 32
SHOULD_LINEMERGE = false
EVENT_BREAKER_ENABLE = true

REPORT-field_extraction_for_scm_system = field_extraction_for_scm_system,field_extraction_action,field_extract_event_description,field_extraction_status_2,field_extract_event_user

FIELDALIAS-dest = Server_Name as dest
FIELDALIAS-dvc = Server_Name as dvc
FIELDALIAS-object = Server_Name as object
FIELDALIAS-result = description as result
FIELDALIAS-body = description as body
FIELDALIAS-signature = description as signature

# Purpose for below "EVAL": trim ' or " or key from field value.
EVAL-Event_Description = nullif(replace(if(match(Event_Description, "^\".*"), trim(Event_Description, "\""), if(match(Event_Description, "^\'.*"), trim(Event_Description, "\'"), Event_Description)), "Event Description:\s*", ""), "")
EVAL-event_action = lower(event_action)
EVAL-result = if(lower(event_status) IN ("failed", "incorrect"), "failure", description)
EVAL-status = if(match(Event_Description, "Symantec Endpoint Protection Manager server started with paid license."), "started", if(lower(event_status) IN ("failed", "incorrect"), "failure", "success"))
EVAL-user_type = if(match(lower(Event_Description), "administrator"), "administrator", null)
EVAL-user_role = if(match(lower(Event_Description), "administrator"), "admin",null)
EVAL-app = "Symantec"
EVAL-vendor_product = "Symantec Endpoint Protection"

LOOKUP-cim_data_model = symantec_ep_data_model_lookup_340 event_description as Event_Description OUTPUT cim_data_model, dataset
LOOKUP-scm_action = symantec_ep_change_action_lookup_340 event_action OUTPUTNEW action
LOOKUP-change_fields = symantec_ep_change_data_model_fields_lookup vendor_action as Event_Description OUTPUTNEW change_type, object_category
LOOKUP-vendor_severity_to_severity = symantec_ep_severity_lookup vendor_severity OUTPUT severity
LOOKUP-authentication_fields = symantec_ep_authentication_fields_lookup description OUTPUTNEW action, reason
LOOKUP-alert_type = symantec_ep_alert_type_lookup_340 description as Event_Description OUTPUTNEW type
LOOKUP-endpoint_service_fields = symantec_ep_endpoint_service_fields_lookup description as Event_Description OUTPUTNEW service_name, service, status

[symantec:ep:scm:system:syslog]
# Copied field extraction from symantec:ep:scm_system:file sourcetype
KV_MODE = none
pulldown_type = true
category = Network & Security
description = Symantec Endpoint Protection server system events
REPORT-field_extraction_for_scm_system = field_extraction_for_scm_system,field_extraction_action,field_extract_event_description,field_extraction_status_2,field_extract_event_user

FIELDALIAS-dest = Server_Name as dest
FIELDALIAS-dvc = Server_Name as dvc
FIELDALIAS-object = Server_Name as object
FIELDALIAS-result = description as result
FIELDALIAS-body = description as body
FIELDALIAS-signature = description as signature

# Purpose for below "EVAL": trim ' or " or key from field value.
EVAL-Event_Description = nullif(replace(if(match(Event_Description, "^\".*"), trim(Event_Description, "\""), if(match(Event_Description, "^\'.*"), trim(Event_Description, "\'"), Event_Description)), "Event Description:\s*", ""), "")
EVAL-event_action = lower(event_action)
EVAL-result = if(lower(event_status) IN ("failed", "incorrect"), "failure", description)
EVAL-status = if(match(Event_Description, "Symantec Endpoint Protection Manager server started with paid license."), "started", if(lower(event_status) IN ("failed", "incorrect"), "failure", "success"))
EVAL-app = "Symantec"
EVAL-vendor_product = "Symantec Endpoint Protection"
EVAL-user_type = if(match(lower(Event_Description), "administrator"), "administrator", null)
EVAL-user_role = if(match(lower(Event_Description), "administrator"), "admin",null)

LOOKUP-cim_data_model = symantec_ep_data_model_lookup_340 event_description as Event_Description OUTPUT cim_data_model, dataset
LOOKUP-scm_action = symantec_ep_change_action_lookup_340 event_action OUTPUTNEW action
LOOKUP-change_fields = symantec_ep_change_data_model_fields_lookup vendor_action as Event_Description OUTPUTNEW change_type, object_category
LOOKUP-authentication_fields = symantec_ep_authentication_fields_lookup description OUTPUTNEW action, reason
LOOKUP-alert_type = symantec_ep_alert_type_lookup_340 description as Event_Description OUTPUTNEW type, severity
LOOKUP-endpoint_service_fields = symantec_ep_endpoint_service_fields_lookup description as Event_Description OUTPUTNEW service_name, service, status

[symantec:ep:agent:file]
TRANSFORMS-nullqueueheader = sep_file_header
KV_MODE = none
pulldown_type = true
category = Network & Security
description = Symantec Endpoint Protection server client agent events
MAX_TIMESTAMP_LOOKAHEAD = 32
SHOULD_LINEMERGE = false
EVENT_BREAKER_ENABLE = true
REPORT-field_extraction_for_agent_act = field_extraction_for_agent_act

######## For CIM Mapping ##########
EVAL-user = nullif(trim(user, "\"'"), "")
FIELDALIAS-src = Host_Name as src
FIELDALIAS-src_user = user as src_user
FIELDALIAS-dest = Server_Name as dest
FIELDALIAS-dvc = Server_Name as dvc
FIELDALIAS-result = Event_Description as result
FIELDALIAS-object = Host_Name as object

EVAL-vendor_product = "Symantec Endpoint Protection"

LOOKUP-vendor_action_for_agent_act = symantec_ep_admin_action_lookup_340 vendor_action as Event_Description OUTPUT action, change_type
LOOKUP-cim_data_model = symantec_ep_data_model_lookup_340 event_description as Event_Description OUTPUTNEW cim_data_model, dataset
LOOKUP-change_fields = symantec_ep_change_data_model_fields_lookup vendor_action as Event_Description OUTPUTNEW status, object_category

[symantec:ep:agent:syslog]
# Copied field extraction from symantec:ep:agent:file sourcetype
KV_MODE = none
pulldown_type = true
category = Network & Security
description = Symantec Endpoint Protection server client agent events
REPORT-field_extraction_for_agent_act = field_extraction_for_agent_act

######## For CIM Mapping ##########
EVAL-user = nullif(trim(user, "\"'"), "")
FIELDALIAS-src = Host_Name as src
FIELDALIAS-src_user = user as src_user
FIELDALIAS-dest = Server_Name as dest
FIELDALIAS-dvc = Server_Name as dvc
FIELDALIAS-result = Event_Description as result
FIELDALIAS-object = Host_Name as object

EVAL-vendor_product = "Symantec Endpoint Protection"

LOOKUP-vendor_action_for_agent_act = symantec_ep_admin_action_lookup_340 vendor_action as Event_Description OUTPUT action, change_type
LOOKUP-cim_data_model = symantec_ep_data_model_lookup_340 event_description as Event_Description OUTPUTNEW cim_data_model, dataset
LOOKUP-change_fields = symantec_ep_change_data_model_fields_lookup vendor_action as Event_Description OUTPUTNEW status, object_category

[symantec:ep:behavior:file]
TRANSFORMS-nullqueueheader = sep_file_header
KV_MODE = none
pulldown_type = true
category = Network & Security
description = Symantec Endpoint Protection agent behavior events
MAX_TIMESTAMP_LOOKAHEAD = 32
SHOULD_LINEMERGE = false
EVENT_BREAKER_ENABLE = true

REPORT-field_extraction_for_agt_behavior = field_extraction_for_agt_behavior, process_from_caller_process_name, caller_md5_from_description, filename_from_caller_process_name

###### For CIM mapping #########
FIELDALIAS-vendor_action_SEP_behavior_vendor_action = vendor_action as SEP_behavior_vendor_action
FIELDALIAS-file_path = Caller_Process_Name as file_path
FIELDALIAS-Domain_Name_dest_nt_domain = Domain_Name as dest_nt_domain
FIELDALIAS-Host_Name_dest = Host_Name as dest
FIELDALIAS-Host_Name_dvc = Host_Name as dvc
FIELDALIAS-app = API as app
FIELDALIAS-bytes = File_Size as bytes
FIELDALIAS-signature = Description as signature

# For the case: "User Name: user1,user2"
EVAL-user = nullif(split(trim(replace(user, "[^:]+:\s*(.*)", "\1"), "\"'"), ","), "")

# For the case: "Rule: Allow ping, pong and tracert"
EVAL-rule = nullif(trim(replace(rule, "[^:]+:\s*(.*)", "\1"), "\"'"), "")
# Purpose for below "EVAL": trim ' or " or key from field value.
EVAL-Description = nullif(replace(if(match(Description, "^\".*"), trim(Description, "\""), if(match(Description, "^\'.*"), trim(Description, "\'"), Description)), "Description:\s*", ""), "")
EVAL-ids_type = "host"
EVAL-vendor_product = "Symantec Endpoint Protection"

LOOKUP-vendor_action_to_action = symantec_ep_action_lookup vendor_action as SEP_behavior_vendor_action OUTPUT action action as SEP_behavior_action
LOOKUP-vendor_severity_to_severity = symantec_ep_severity_lookup vendor_severity OUTPUT severity

[symantec:ep:behavior:syslog]
# Copied field extraction from symantec:ep:behavior:file sourcetype
KV_MODE = none
pulldown_type = true
category = Network & Security
description = Symantec Endpoint Protection agent behavior events
REPORT-field_extraction_for_agt_behavior = field_extraction_for_agt_behavior, process_from_caller_process_name, caller_md5_from_description, filename_from_caller_process_name

###### For CIM mapping #########
FIELDALIAS-vendor_action_SEP_behavior_vendor_action = vendor_action as SEP_behavior_vendor_action
FIELDALIAS-file_path = Caller_Process_Name as file_path
FIELDALIAS-Domain_Name_dest_nt_domain = Domain_Name as dest_nt_domain
FIELDALIAS-Host_Name_dest = Host_Name as dest
FIELDALIAS-Host_Name_dvc = Host_Name as dvc
FIELDALIAS-app = API as app
FIELDALIAS-bytes = File_Size as bytes
FIELDALIAS-signature = Description as signature

# For the case: "User Name: user1,user2"
EVAL-user = nullif(split(trim(replace(user, "[^:]+:\s*(.*)", "\1"), "\"'"), ","), "")
# For the case: "Rule: Allow ping, pong and tracert"
EVAL-rule = nullif(trim(replace(rule, "[^:]+:\s*(.*)", "\1"), "\"'"), "")
# Purpose for below "EVAL": trim ' or " or key from field value.
EVAL-Description = nullif(replace(if(match(Description, "^\".*"), trim(Description, "\""), if(match(Description, "^\'.*"), trim(Description, "\'"), Description)), "Description:\s*", ""), "")
EVAL-ids_type = "host"
EVAL-vendor_product = "Symantec Endpoint Protection"

LOOKUP-vendor_action_to_action = symantec_ep_action_lookup vendor_action as SEP_behavior_vendor_action OUTPUT action action as SEP_behavior_action

[symantec:ep:risk:file]
TRANSFORMS-nullqueueheader = sep_file_header
KV_MODE = none
pulldown_type = true
category = Network & Security
description = Symantec Endpoint Protection agent risk events
MAX_TIMESTAMP_LOOKAHEAD = 32
SHOULD_LINEMERGE = false
EVENT_BREAKER_ENABLE = true

REPORT-field_extraction_for_agt_risk = field_extraction_key_value_pairs_1, field_extraction_key_value_pairs_2, field_extraction_key_value_pairs_3, field_extraction_key_value_pairs_4, field_extraction_key_value_pairs_5, field_extraction_risk_action, field_extraction_file_path_description, field_extraction_agt_risk_reason_for_allowing, field_extraction_agt_risk_unknown_field

###### For CIM mapping #######
FIELDALIAS-vendor_action = "Actual action" as vendor_action
FIELDALIAS-Application_Hash = "Application hash" as Application_Hash
FIELDALIAS-Application_Name = "Application name" as Application_Name
FIELDALIAS-Application_Type = "Application type" as Application_Type
FIELDALIAS-Application_Version = "Application version" as Application_Version
FIELDALIAS-Category_Set = "Category set" as Category_Set
FIELDALIAS-Category_Type = "Category type" as Category_Type
FIELDALIAS-Certificate_Issuer = "Certificate issuer" as Certificate_Issuer
FIELDALIAS-Certificate_Serial_Number = "Certificate serial number" as Certificate_Serial_Number
FIELDALIAS-Certificate_Signer = "Certificate signer" as Certificate_Signer
FIELDALIAS-Certificate_Thumbprint = "Certificate thumbprint" as Certificate_Thumbprint
FIELDALIAS-Company_Name = "Company name" as Company_Name
FIELDALIAS-Computer_Name = "Computer name" as Computer_Name
FIELDALIAS-Download_Site = "Download site" as Download_Site
FIELDALIAS-Downloaded_By = "Downloaded by" as Downloaded_By
FIELDALIAS-Event_Time = "Event time" as Event_Time
FIELDALIAS-File_Size = "File size (bytes)" as File_Size
FIELDALIAS-First_Seen = "First Seen" as First_Seen
FIELDALIAS-Hash_Type = "Hash type" as Hash_Type
FIELDALIAS-IP_Address = "IP Address" as IP_Address
FIELDALIAS-Intensive_Protection_Level = "Intensive Protection Level" as Intensive_Protection_Level
FIELDALIAS-Last_Update_Time = "Last update time" as Last_Update_Time
FIELDALIAS-Requested_Action = "Requested action" as Requested_Action
FIELDALIAS-Risk_Name = "Risk name" as Risk_Name
FIELDALIAS-Secondary_Action = "Secondary action" as Secondary_Action
FIELDALIAS-Signing_Timestamp = "Signing timestamp" as Signing_Timestamp
FIELDALIAS-URL_Tracking_Status = "URL Tracking Status" as URL_Tracking_Status
FIELDALIAS-Web_Domain = "Web domain" as Web_Domain
FIELDALIAS-SEP_risk_signature = "Risk name" as SEP_risk_signature
FIELDALIAS-category = "Category type" as category
FIELDALIAS-signature = "Risk name" as signature
FIELDALIAS-file_hash = "Application hash" as file_hash
FIELDALIAS-file_hash_type = "Hash type" as file_hash_type
FIELDALIAS-dest = "Computer name" as dest
FIELDALIAS-dest_ip = "IP Address" as dest_ip

EVAL-Domain_Name = coalesce('Domain','Domain Name')
EVAL-End_Time = coalesce('End','End Time')
EVAL-Event_Insert_Time = coalesce('Inserted','Event Insert Time')
EVAL-Group_Name = coalesce('Group','Group Name')
EVAL-Server_Name = coalesce('Server Name','Server')
EVAL-Source_Computer_Name = coalesce('Source computer','Source Computer Name')
EVAL-Source_Computer_IP = coalesce('Source IP','Source Computer IP')

# For the case: "User Name: user1,user2"
EVAL-user = nullif(split(trim(replace(coalesce('User', 'User Name'), "[^:]+:\s*(.*)", "\1"), "\"'"), ","), "")

# trim the quotation marks and key from value
EVAL-Description = nullif(replace(if(match(Description, "^\".*"), trim(Description, "\""), if(match(Description, "^\'.*"), trim(Description, "\'"), Description)), "Description:\s*", ""), "")
EVAL-Reason_For_Allowing = if(match(Reason_For_Allowing, ":"), trim(replace(Reason_For_Allowing, ".*:", "")), Reason_For_Allowing)

# For the case "Field: null" set the field to be null.
EVAL-Web_Domain = if(Web_Domain=="" OR Web_Domain=="null", null, Web_Domain)
EVAL-Downloaded_By = if(Downloaded_By=="null" OR Downloaded_By=="", null, Downloaded_By)
EVAL-Download_Site = if(Download_Site=="null" OR Download_Site=="", null, Download_Site)
EVAL-url = if(Download_Site=="null" OR Download_Site=="", null, Download_Site)

# Removing the string "File path: from value of file_path
EVAL-file_path = nullif(replace(lower(file_path), "file path:\s*", ""), "")

EVAL-date = nullif(replace(Event_Time, "\s*(\S+)\s.*", "\1"), "")
EVAL-file_name = nullif(replace(file_path, ".*[\\\|\/](.+)", "\1"), "")
EVAL-vendor_product = "Symantec Endpoint Protection"
EVAL-src = coalesce('Source computer','Source Computer Name')
EVAL-src_ip = coalesce('Source IP','Source Computer IP')
EVAL-dest_nt_domain = coalesce('Domain','Domain Name')

LOOKUP-risk_vendor_action_to_action = symantec_ep_action_lookup vendor_action OUTPUT action

[symantec:ep:risk:syslog]
# Copied field extraction from symantec:ep:risk:file sourcetype
KV_MODE = none
pulldown_type = true
category = Network & Security
description = Symantec Endpoint Protection agent risk events

REPORT-field_extraction_for_agt_risk = field_extraction_key_value_pairs_1, field_extraction_key_value_pairs_2, field_extraction_key_value_pairs_3, field_extraction_key_value_pairs_4, field_extraction_key_value_pairs_5, field_extraction_risk_action, field_extraction_file_path_description, field_extraction_agt_risk_reason_for_allowing, field_extraction_agt_risk_unknown_field

###### For CIM mapping #######

FIELDALIAS-vendor_action = "Actual action" as vendor_action
FIELDALIAS-Application_Hash = "Application hash" as Application_Hash
FIELDALIAS-Application_Name = "Application name" as Application_Name
FIELDALIAS-Application_Type = "Application type" as Application_Type
FIELDALIAS-Application_Version = "Application version" as Application_Version
FIELDALIAS-Category_Set = "Category set" as Category_Set
FIELDALIAS-Category_Type = "Category type" as Category_Type
FIELDALIAS-Certificate_Issuer = "Certificate issuer" as Certificate_Issuer
FIELDALIAS-Certificate_Serial_Number = "Certificate serial number" as Certificate_Serial_Number
FIELDALIAS-Certificate_Signer = "Certificate signer" as Certificate_Signer
FIELDALIAS-Certificate_Thumbprint = "Certificate thumbprint" as Certificate_Thumbprint
FIELDALIAS-Company_Name = "Company name" as Company_Name
FIELDALIAS-Computer_Name = "Computer name" as Computer_Name
FIELDALIAS-Download_Site = "Download site" as Download_Site
FIELDALIAS-Downloaded_By = "Downloaded by" as Downloaded_By
FIELDALIAS-Event_Time = "Event time" as Event_Time
FIELDALIAS-File_Size = "File size (bytes)" as File_Size
FIELDALIAS-First_Seen = "First Seen" as First_Seen
FIELDALIAS-Hash_Type = "Hash type" as Hash_Type
FIELDALIAS-IP_Address = "IP Address" as IP_Address
FIELDALIAS-Intensive_Protection_Level = "Intensive Protection Level" as Intensive_Protection_Level
FIELDALIAS-Last_Update_Time = "Last update time" as Last_Update_Time
FIELDALIAS-Requested_Action = "Requested action" as Requested_Action
FIELDALIAS-Risk_Name = "Risk name" as Risk_Name
FIELDALIAS-Secondary_Action = "Secondary action" as Secondary_Action
FIELDALIAS-Signing_Timestamp = "Signing timestamp" as Signing_Timestamp
FIELDALIAS-URL_Tracking_Status = "URL Tracking Status" as URL_Tracking_Status
FIELDALIAS-Web_Domain = "Web domain" as Web_Domain
FIELDALIAS-SEP_risk_signature = "Risk name" as SEP_risk_signature
FIELDALIAS-category = "Category type" as category
FIELDALIAS-signature = "Risk name" as signature
FIELDALIAS-file_hash = "Application hash" as file_hash
FIELDALIAS-file_hash_type = "Hash type" as file_hash_type
FIELDALIAS-dest = "Computer name" as dest
FIELDALIAS-dest_ip = "IP Address" as dest_ip

EVAL-Domain_Name = coalesce('Domain','Domain Name')
EVAL-End_Time = coalesce('End','End Time')
EVAL-Event_Insert_Time = coalesce('Inserted','Event Insert Time')
EVAL-Group_Name = coalesce('Group','Group Name')
EVAL-Server_Name = coalesce('Server Name','Server')
EVAL-Source_Computer_Name = coalesce('Source computer','Source Computer Name')
EVAL-Source_Computer_IP = coalesce('Source IP','Source Computer IP')

# For the case: "User Name: user1,user2"
EVAL-user = nullif(split(trim(replace(coalesce('User', 'User Name'), "[^:]+:\s*(.*)", "\1"), "\"'"), ","), "")

# trim the quotation marks and key from value
EVAL-Description = nullif(replace(if(match(Description, "^\".*"), trim(Description, "\""), if(match(Description, "^\'.*"), trim(Description, "\'"), Description)), "Description:\s*", ""), "")
EVAL-Reason_For_Allowing = if(match(Reason_For_Allowing, ":"), trim(replace(Reason_For_Allowing, ".*:", "")), Reason_For_Allowing)

# For the case "Field: null" set the field to be null.
EVAL-Web_Domain = if(Web_Domain=="" OR Web_Domain=="null", null, Web_Domain)
EVAL-Downloaded_By = if(Downloaded_By=="null" OR Downloaded_By=="", null, Downloaded_By)
EVAL-Download_Site = if(Download_Site=="null" OR Download_Site=="", null, Download_Site)
EVAL-url = if(Download_Site=="null" OR Download_Site=="", null, Download_Site)

# Removing the string "File path: from value of file_path
EVAL-file_path = nullif(replace(lower(file_path), "file path:\s*", ""), "")

EVAL-date = nullif(replace(Event_Time, "\s*(\S+)\s.*", "\1"), "")
EVAL-file_name = nullif(replace(file_path, ".*[\\\|\/](.+)", "\1"), "")
EVAL-vendor_product = "Symantec Endpoint Protection"
EVAL-src = coalesce('Source computer','Source Computer Name')
EVAL-src_ip = coalesce('Source IP','Source Computer IP')
EVAL-dest_nt_domain = coalesce('Domain','Domain Name')

LOOKUP-risk_vendor_action_to_action = symantec_ep_action_lookup vendor_action OUTPUT action


[symantec:ep:security:file]
TRANSFORMS-nullqueueheader = sep_file_header
KV_MODE = none
pulldown_type = true
category = Network & Security
description = Symantec Endpoint Protection agent security events
MAX_TIMESTAMP_LOOKAHEAD = 32
SHOULD_LINEMERGE = false
EVENT_BREAKER_ENABLE = true

REPORT-field_extraction_for_agt_security = field_extraction_for_agt_security_1, field_extraction_for_agt_security_2, field_extraction_for_agt_security_3, category_from_description, filename_from_filepath

##### For CIM mapping ########

FIELDALIAS-file_path = Application_Name as file_path
FIELDALIAS-dvc = Host_Name as dvc
FIELDALIAS-signature = CIDS_Signature_String as signature
FIELDALIAS-signature_id = CIDS_Signature_ID as signature_id
FIELDALIAS-transport = Network_Protocol as transport
FIELDALIAS-description = Event_Description as description

EVAL-Host_Name = trim(trim(Host_Name,"\'"),"\"")
EVAL-Intrusion_URL = trim(trim(Intrusion_URL,"\'"),"\"")
EVAL-category = case(match(Event_Description,"Denial of Service"),"Denial of Service",isnull(trim(Event_Type)), category, true(), Event_Type)

# For the case: "User Name: user1,user2"
EVAL-user = nullif(split(trim(replace(user, "[^:]+:\s*(.*)", "\1"), "\"'"), ","), "")
# Purpose for below "EVAL": trim ' or " or key from field value.
EVAL-Event_Description = nullif(replace(if(match(Event_Description, "^\".*"), trim(Event_Description, "\""), if(match(Event_Description, "^\'.*"), trim(Event_Description, "\'"), Event_Description)), "Event Description:\s*", ""), "")
# Trim quotation marks
EVAL-direction = lower(Traffic_Direction)
EVAL-dest = if(match(Event_Description, "Host Integrity check passed"), Host_Name, if(Traffic_Direction=="Inbound" OR Traffic_Direction == "Unknown", Local_Host_IP, Remote_Host_IP))
EVAL-src = if(match(Event_Description, "Host Integrity check passed") OR Traffic_Direction=="Outbound", Local_Host_IP, Remote_Host_IP)
EVAL-action = case(match(Event_Description, "[nN]ot(\s+\w*)?\s[bB]lock"), "allowed", match(Event_Description, "[bB]lock"), "blocked", match(Event_Description, "[nN]ot(\s+\w*)?\s[aA]llow"), "blocked", 1==1, "allowed")
EVAL-dest_ip = if(Traffic_Direction=="Inbound" OR Traffic_Direction == "Unknown", Local_Host_IP, Remote_Host_IP)
EVAL-src_ip = if(Traffic_Direction=="Outbound", Local_Host_IP, Remote_Host_IP)
EVAL-dest_port = if(Traffic_Direction=="Inbound" OR Traffic_Direction == "Unknown", Local_Port, Remote_Port)
EVAL-src_port = if(Traffic_Direction=="Outbound", Local_Port, Remote_Port)
EVAL-app = if(match(Event_Description, "Host Integrity check passed"), "Symantec Endpoint Protection", app)
EVAL-body = if(match(Event_Description, "Host Integrity check passed"), "Host Integrity check passed", body)
EVAL-vendor_product = "Symantec Endpoint Protection"
EVAL-ids_type = "host"

LOOKUP-cim_data_model = symantec_ep_data_model_lookup_340 event_description as Event_Description OUTPUT cim_data_model, dataset
LOOKUP-vendor_severity_to_severity = symantec_ep_severity_lookup vendor_severity OUTPUT severity
LOOKUP-alert_type = symantec_ep_alert_type_lookup_340 description as Event_Description OUTPUTNEW type

[symantec:ep:security:syslog]
# Copied field extraction from symantec:ep:security:file sourcetype
KV_MODE = none
pulldown_type = true
category = Network & Security
description = Symantec Endpoint Protection agent security events

REPORT-field_extraction_for_agt_security = field_extraction_for_agt_security_1, field_extraction_for_agt_security_2, field_extraction_for_agt_security_3, category_from_description, filename_from_filepath

##### For CIM mapping ########

FIELDALIAS-file_path = Application_Name as file_path
FIELDALIAS-dvc = Host_Name as dvc
FIELDALIAS-signature = CIDS_Signature_String as signature
FIELDALIAS-signature_id = CIDS_Signature_ID as signature_id
FIELDALIAS-transport = Network_Protocol as transport
FIELDALIAS-description = Event_Description as description

EVAL-Host_Name = trim(trim(Host_Name,"\'"),"\"")
EVAL-Intrusion_URL = trim(trim(Intrusion_URL,"\'"),"\"")
EVAL-category = if(isnull(trim(Event_Type)), category, Event_Type)

# For the case: "User Name: user1,user2"
EVAL-user = nullif(split(trim(replace(user, "[^:]+:\s*(.*)", "\1"), "\"'"), ","), "")
# Purpose for below "EVAL": trim ' or " or key from field value.
EVAL-Event_Description = nullif(replace(if(match(Event_Description, "^\".*"), trim(Event_Description, "\""), if(match(Event_Description, "^\'.*"), trim(Event_Description, "\'"), Event_Description)), "Event Description:\s*", ""), "")
EVAL-direction = lower(Traffic_Direction)
EVAL-dest = if(match(Event_Description, "Host Integrity check passed"), Host_Name, if(Traffic_Direction=="Inbound" OR Traffic_Direction == "Unknown", Local_Host_IP, Remote_Host_IP))
EVAL-src = if(match(Event_Description, "Host Integrity check passed") OR Traffic_Direction=="Outbound", Local_Host_IP, Remote_Host_IP)
EVAL-action = case(match(Event_Description, "[nN]ot(\s+\w*)?\s[bB]lock"), "allowed", match(Event_Description, "[bB]lock"), "blocked", match(Event_Description, "[nN]ot(\s+\w*)?\s[aA]llow"), "blocked", 1==1, "allowed")
EVAL-dest_ip = if(Traffic_Direction=="Inbound" OR Traffic_Direction == "Unknown", Local_Host_IP, Remote_Host_IP)
EVAL-src_ip = if(Traffic_Direction=="Outbound", Local_Host_IP, Remote_Host_IP)
EVAL-dest_port = if(Traffic_Direction=="Inbound" OR Traffic_Direction == "Unknown", Local_Port, Remote_Port)
EVAL-src_port = if(Traffic_Direction=="Outbound", Local_Port, Remote_Port)
EVAL-app = if(match(Event_Description, "Host Integrity check passed"), "Symantec Endpoint Protection", app)
EVAL-body = if(match(Event_Description, "Host Integrity check passed"), "Host Integrity check passed", body)
EVAL-vendor_product = "Symantec Endpoint Protection"
EVAL-ids_type = "host"

LOOKUP-cim_data_model = symantec_ep_data_model_lookup_340 event_description as Event_Description OUTPUT cim_data_model, dataset
LOOKUP-alert_type = symantec_ep_alert_type_lookup_340 description as Event_Description OUTPUTNEW type

[symantec:ep:scan:file]
TRANSFORMS-nullqueueheader = sep_file_header
KV_MODE = none
pulldown_type = true
category = Network & Security
description = Symantec Endpoint Protection agent scan events
MAX_TIMESTAMP_LOOKAHEAD = 32
SHOULD_LINEMERGE = false
EVENT_BREAKER_ENABLE = true

REPORT-field_extraction_for_agt_scan = field_extraction_key_value_pairs_1, field_extraction_key_value_pairs_2, field_extraction_key_value_pairs_3, field_extraction_key_value_pairs_4, field_extraction_key_value_pairs_5, field_extraction_status, field_extraction_start_message_stop_message, field_extract_body_message

##### For CIM mapping ######
FIELDALIAS-Scan_ID = "Scan ID" as Scan_ID
FIELDALIAS-Duration = "Duration (seconds)" as Duration
FIELDALIAS-Client_User_1 = "User1" as Client_User_1
FIELDALIAS-Client_User_2 = "User2" as Client_User_2
FIELDALIAS-Infected_Files = "Infected" as Infected_Files
FIELDALIAS-Omitted_Files = "Omitted" as Omitted_Files
FIELDALIAS-IP_Addres= "IP Address" as IP_Address
FIELDALIAS-body = body_message as body
FIELDALIAS-id = "Scan ID" as id
FIELDALIAS-signature_id = "Scan ID" as signature_id
FIELDALIAS-SEP_Scan_Infected_Files = "Infected" as SEP_Scan_Infected_Files
FIELDALIAS-dest_ip = "IP Address" as dest_ip
FIELDALIAS-description = "body_message" as description

EVAL-Begin_Time = coalesce('Begin','Begin Time')
EVAL-End_Time = coalesce('End','End Time')
EVAL-Computer_Name = coalesce('Computer','Computer Name')
EVAL-Domain_Name = coalesce('Domain','Domain Name')
EVAL-Group_Name = coalesce('Group','Group Name')
EVAL-Server_Name = coalesce('Server','Server Name')
EVAL-src = coalesce('Server','Server Name')
EVAL-Start_Message = nullif(trim(Start_Message, "\"'"), "")
EVAL-Stop_Message = nullif(trim(Stop_Message, "\"'"), "")
# For the case: "Totalfiles"
EVAL-Total_Files = coalesce('Total files','Totalfiles')
EVAL-vendor_product = "Symantec Endpoint Protection"
EVAL-dest = coalesce('Computer','Computer Name')
EVAL-dest_nt_domain = coalesce('Domain','Domain Name')
EVAL-user = coalesce(User1, User2)
EVAL-type = "alert"
EVAL-app = "Symantec"

[symantec:ep:scan:syslog]
# Copied field extraction from symantec:ep:scan:file sourcetype
KV_MODE = none
pulldown_type = true
category = Network & Security
description = Symantec Endpoint Protection agent scan events

REPORT-field_extraction_for_agt_scan = field_extraction_key_value_pairs_1, field_extraction_key_value_pairs_2, field_extraction_key_value_pairs_3, field_extraction_key_value_pairs_4, field_extraction_key_value_pairs_5, field_extraction_status, field_extraction_start_message_stop_message, field_extract_body_message

##### For CIM mapping ######
FIELDALIAS-Scan_ID = "Scan ID" as Scan_ID
FIELDALIAS-Duration = "Duration (seconds)" as Duration
FIELDALIAS-Client_User_1 = "User1" as Client_User_1
FIELDALIAS-Client_User_2 = "User2" as Client_User_2
FIELDALIAS-Infected_Files = "Infected" as Infected_Files
FIELDALIAS-Omitted_Files = "Omitted" as Omitted_Files
FIELDALIAS-IP_Address = "IP Address" as IP_Address
FIELDALIAS-body = body_message as body
FIELDALIAS-id = "Scan ID" as id
FIELDALIAS-signature_id = "Scan ID" as signature_id
FIELDALIAS-SEP_Scan_Infected_Files = "Infected" as SEP_Scan_Infected_Files
FIELDALIAS-dest_ip = "IP Address" as dest_ip
FIELDALIAS-description = "body_message" as description

EVAL-Begin_Time = coalesce('Begin','Begin Time')
EVAL-End_Time = coalesce('End','End Time')
EVAL-Computer_Name = coalesce('Computer','Computer Name')
EVAL-Domain_Name = coalesce('Domain','Domain Name')
EVAL-Group_Name = coalesce('Group','Group Name')
EVAL-Server_Name = coalesce('Server','Server Name')
EVAL-src = coalesce('Server','Server Name')
EVAL-Start_Message = nullif(trim(Start_Message, "\"'"), "")
EVAL-Stop_Message = nullif(trim(Stop_Message, "\"'"), "")
# For the case: "Totalfiles"
EVAL-Total_Files = coalesce('Total files','Totalfiles')
EVAL-vendor_product = "Symantec Endpoint Protection"
EVAL-dest = coalesce('Computer','Computer Name')
EVAL-dest_nt_domain = coalesce('Domain','Domain Name')
EVAL-user = coalesce(User1, User2)
EVAL-type = "alert"
EVAL-app = "Symantec"

[symantec:ep:proactive:file]
TRANSFORMS-nullqueueheader = sep_file_header
KV_MODE = none
pulldown_type = true
category = Network & Security
description = Symantec Endpoint Protection agent proactive events
MAX_TIMESTAMP_LOOKAHEAD = 32
SHOULD_LINEMERGE = false
EVENT_BREAKER_ENABLE = true
REPORT-field_extraction_for_agt_proactive = field_extraction_key_value_pairs_1, field_extraction_key_value_pairs_2, field_extraction_key_value_pairs_3, field_extraction_key_value_pairs_4, field_extraction_key_value_pairs_5, field_extraction_risk_action, field_extraction_file_path_description, field_extraction_proactive_submission_recommendation
FIELDALIAS-0_rename_fields_from_proactive_file_report = "Computer name" as Computer_Name "IP Address" as IP_Address "Detection type" as Detection_Type "First Seen" as First_Seen  "Application name" as Application_Name "Application type" as Application_Type "Application version" as Application_Version "Hash type" as Hash_Type "Application hash" as Application_Hash "Company name" as Company_Name "File size (bytes)" as File_Size "Detection score" as Detection_Score "COH Engine Version" as COH_Engine_Version "Permitted application reason" as Permitted_Application_Reason "Download site" as Download_Site "Web domain" as Web_Domain "Downloaded by" as Downloaded_By "URL Tracking Status" as URL_Tracking_Status "Risk Level" as Risk_Level "Risk type" as Risk_Type "Detection Source" as Detection_Source "Risk name" as Risk_Name "Actual action" as vendor_action "Requested action" as Requested_Action "Secondary action" as Secondary_Action "Event time" as Event_Time "Intensive Protection Level" as Intensive_Protection_Level "Certificate issuer" as Certificate_Issuer "Certificate signer" as Certificate_Signer "Certificate thumbprint" as Certificate_Thumbprint "Signing timestamp" as Signing_Timestamp "Certificate serial number" as Certificate_Serial_Number

EVAL-Source_Computer_Name = coalesce('Source computer','Source Computer Name')
EVAL-Source_Computer_IP = coalesce('Source IP','Source Computer IP')
EVAL-Domain_Name = coalesce('Domain','Domain Name')
EVAL-Server_Name = coalesce('Server','Server Name')
EVAL-Group_Name = coalesce('Group','Group Name')
EVAL-Detection_Source = if(Detection_Source=="" OR Detection_Source=="N/A", null, Detection_Source)
EVAL-Web_Domain = if(Web_Domain=="" OR Web_Domain=="null", null, Web_Domain)
EVAL-Downloaded_By = if(Downloaded_By=="null" OR Downloaded_By=="", null, Downloaded_By)
EVAL-Download_Site = if(Download_Site=="null" OR Download_Site=="", null, Download_Site)
EVAL-url = if(Download_Site=="null" OR Download_Site=="", null, Download_Site)
EVAL-End_Time = coalesce('End','End Time')
EVAL-Event_Insert_Time = coalesce('Inserted','Event Insert Time')
FIELDALIAS-category = "Detection type" as category

# Purpose for below "EVAL": trim ' or " or key from field value.
EVAL-Description = nullif(replace(if(match(Description, "^\".*"), trim(Description, "\""), if(match(Description, "^\'.*"), trim(Description, "^\'"), Description)), "Description:\s*", ""), "")
# trim the quotation marks
EVAL-Application_Version = nullif(trim(Application_Version, "\"'"), "")

# For the case: "User Name: user1,user2"
EVAL-user = nullif(split(trim(replace(coalesce('User','User Name'), "[^:]+:\s*(.*)", "\1"), "\"'"), ","), "")

##### For CIM mapping #######
EVAL-date = nullif(replace(Event_Time, "\s*(\S+)\s.*", "\1"), "")
EVAL-file_name = nullif(replace(file_path, ".*[\\\|\/](.+)", "\1"), "")
FIELDALIAS-signature = "Risk name" as signature
EVAL-vendor_product = "Symantec Endpoint Protection"
EVAL-src = coalesce('Source computer','Source Computer Name')
EVAL-src_ip = coalesce('Source IP','Source Computer IP')
FIELDALIAS-dest = "Computer name" as dest
EVAL-dest_nt_domain = coalesce('Domain','Domain Name')
FIELDALIAS-file_hash = "Application hash" as file_hash
FIELDALIAS-file_hash_type = "Hash type" as file_hash_type
LOOKUP-proactive_vendor_action_to_action = symantec_ep_action_lookup vendor_action OUTPUT action

[symantec:ep:proactive:syslog]
# Copied field extraction from symantec:ep:proactive:file sourcetype
KV_MODE = none
pulldown_type = true
category = Network & Security
description = Symantec Endpoint Protection agent proactive events
REPORT-field_extraction_for_agt_proactive = field_extraction_key_value_pairs_1, field_extraction_key_value_pairs_2, field_extraction_key_value_pairs_3, field_extraction_key_value_pairs_4, field_extraction_key_value_pairs_5, field_extraction_risk_action, field_extraction_file_path_description, field_extraction_proactive_submission_recommendation
FIELDALIAS-0_rename_fields_from_proactive_file_report = "Computer name" as Computer_Name "IP Address" as IP_Address "Detection type" as Detection_Type "First Seen" as First_Seen  "Application name" as Application_Name "Application type" as Application_Type "Application version" as Application_Version "Hash type" as Hash_Type "Application hash" as Application_Hash "Company name" as Company_Name "File size (bytes)" as File_Size "Detection score" as Detection_Score "COH Engine Version" as COH_Engine_Version "Permitted application reason" as Permitted_Application_Reason "Download site" as Download_Site "Web domain" as Web_Domain "Downloaded by" as Downloaded_By "URL Tracking Status" as URL_Tracking_Status "Risk Level" as Risk_Level "Risk type" as Risk_Type "Detection Source" as Detection_Source "Risk name" as Risk_Name "Actual action" as vendor_action "Requested action" as Requested_Action "Secondary action" as Secondary_Action "Event time" as Event_Time "Intensive Protection Level" as Intensive_Protection_Level "Certificate issuer" as Certificate_Issuer "Certificate signer" as Certificate_Signer "Certificate thumbprint" as Certificate_Thumbprint "Signing timestamp" as Signing_Timestamp "Certificate serial number" as Certificate_Serial_Number

EVAL-Source_Computer_Name = coalesce('Source computer','Source Computer Name')
EVAL-Source_Computer_IP = coalesce('Source IP','Source Computer IP')
EVAL-Domain_Name = coalesce('Domain','Domain Name')
EVAL-Server_Name = coalesce('Server','Server Name')
EVAL-Group_Name = coalesce('Group','Group Name')
EVAL-Detection_Source = if(Detection_Source=="" OR Detection_Source=="N/A", null, Detection_Source)
EVAL-Web_Domain = if(Web_Domain=="" OR Web_Domain=="null", null, Web_Domain)
EVAL-Downloaded_By = if(Downloaded_By=="null" OR Downloaded_By=="", null, Downloaded_By)
EVAL-Download_Site = if(Download_Site=="null" OR Download_Site=="", null, Download_Site)
EVAL-url = if(Download_Site=="null" OR Download_Site=="", null, Download_Site)
EVAL-End_Time = coalesce('End','End Time')
EVAL-Event_Insert_Time = coalesce('Inserted','Event Insert Time')
FIELDALIAS-category = "Detection type" as category

# Purpose for below "EVAL": trim ' or " or key from field value.
EVAL-Description = nullif(replace(if(match(Description, "^\".*"), trim(Description, "\""), if(match(Description, "^\'.*"), trim(Description, "^\'"), Description)), "Description:\s*", ""), "")
# trim the quotation marks
EVAL-Application_Version = nullif(trim(Application_Version, "\"'"), "")

# For the case: "User Name: user1,user2"
EVAL-user = nullif(split(trim(replace(coalesce('User','User Name'), "[^:]+:\s*(.*)", "\1"), "\"'"), ","), "")

##### For CIM mapping #######
EVAL-date = nullif(replace(Event_Time, "\s*(\S+)\s.*", "\1"), "")
EVAL-file_name = nullif(replace(file_path, ".*[\\\|\/](.+)", "\1"), "")
FIELDALIAS-signature = "Risk name" as signature
EVAL-vendor_product = "Symantec Endpoint Protection"
EVAL-src = coalesce('Source computer','Source Computer Name')
EVAL-src_ip = coalesce('Source IP','Source Computer IP')
FIELDALIAS-dest = "Computer name" as dest
EVAL-dest_nt_domain = coalesce('Domain','Domain Name')
FIELDALIAS-file_hash = "Application hash" as file_hash
FIELDALIAS-file_hash_type = "Hash type" as file_hash_type
LOOKUP-proactive_vendor_action_to_action = symantec_ep_action_lookup vendor_action OUTPUT action


[symantec:ep:admin:file]
TRANSFORMS-nullqueueheader = sep_file_header
KV_MODE = none
pulldown_type = true
category = Network & Security
description = Symantec Endpoint Protection server admin events
MAX_TIMESTAMP_LOOKAHEAD = 32
SHOULD_LINEMERGE = false
EVENT_BREAKER_ENABLE = true

REPORT-field_extraction_for_admin = field_extraction_for_admin, field_extraction_action

##### For CIM mapping ######

FIELDALIAS-user = "Admin_Name" as user
FIELDALIAS-dest = "Server_Name" as dest
FIELDALIAS-dvc = Server_Name as dvc
FIELDALIAS-result = Event_Description as result
FIELDALIAS-dest_nt_domain = Domain_Name as dest_nt_domain

EVAL-object = case(match(lower(Event_Description), "administrator"), Admin_Name, match(Event_Description, "Domain"), Domain_Name, 1=1, "client")
EVAL-src_user = if(match(lower(Event_Description), "log on"), Admin_Name, src_user)
EVAL-signature = if(match(lower(Event_Description), "log on"), Event_Description, signature)
EVAL-event_action = lower(event_action)
EVAL-user_type = if(match(lower(Event_Description), "administrator"), "administrator", null)
EVAL-user_role = if(match(lower(Event_Description), "administrator"), "admin",null)
EVAL-vendor_product = "Symantec Endpoint Protection"
EVAL-app = "Symantec"

LOOKUP-Event_Description_to_action = symantec_ep_admin_authentication_action_lookup Event_Description OUTPUT action
LOOKUP-cim_data_model = symantec_ep_data_model_lookup_340 event_description as Event_Description OUTPUT cim_data_model, dataset
LOOKUP-admin_action = symantec_ep_change_action_lookup_340 event_action OUTPUTNEW action
LOOKUP-action = symantec_ep_change_action_lookup_340 event_action OUTPUTNEW action
LOOKUP-change_type = symantec_ep_change_data_model_fields_lookup vendor_action as Event_Description OUTPUTNEW change_type, status, object_category
LOOKUP-status = symantec_ep_change_data_model_fields_lookup vendor_action as Event_Description OUTPUTNEW change_type, status, object_category
LOOKUP-object_category = symantec_ep_change_data_model_fields_lookup vendor_action as Event_Description OUTPUTNEW object_category
LOOKUP-auth_fields = symantec_ep_authentication_fields_lookup description as Event_Description OUTPUTNEW reason

[symantec:ep:admin:syslog]
# Copied field extraction from symantec:ep:admin:file sourcetype
KV_MODE = none
pulldown_type = true
category = Network & Security
description = Symantec Endpoint Protection server admin events

REPORT-field_extraction_for_admin = field_extraction_for_admin, field_extraction_action

##### For CIM mapping ######

FIELDALIAS-user = "Admin_Name" as user
FIELDALIAS-dest = "Server_Name" as dest
FIELDALIAS-dvc = Server_Name as dvc
FIELDALIAS-result = Event_Description as result
FIELDALIAS-dest_nt_domain = Domain_Name as dest_nt_domain
FIELDALIAS-src_user = "Admin_Name" as src_user

EVAL-object = case(match(lower(Event_Description), "administrator"), Admin_Name, match(Event_Description, "Domain"), Domain_Name, 1=1, "client")
EVAL-src_user = if(match(lower(Event_Description), "log on"), Admin_Name, src_user)
EVAL-signature = if(match(lower(Event_Description), "log on"), Event_Description, signature)
EVAL-event_action = lower(event_action)
EVAL-vendor_product = "Symantec Endpoint Protection"
EVAL-app = "Symantec"
EVAL-user_type = if(match(lower(Event_Description), "administrator"), "administrator", null)
EVAL-user_role = if(match(lower(Event_Description), "administrator"), "admin",null)

LOOKUP-Event_Description_to_action = symantec_ep_admin_authentication_action_lookup Event_Description OUTPUT action
LOOKUP-cim_data_model = symantec_ep_data_model_lookup_340 event_description as Event_Description OUTPUT cim_data_model, dataset
LOOKUP-admin_action = symantec_ep_change_action_lookup_340 event_action OUTPUTNEW action
LOOKUP-action = symantec_ep_change_action_lookup_340 event_action OUTPUTNEW action
LOOKUP-change_type = symantec_ep_change_data_model_fields_lookup vendor_action as Event_Description OUTPUTNEW change_type, status, object_category
LOOKUP-status = symantec_ep_change_data_model_fields_lookup vendor_action as Event_Description OUTPUTNEW change_type, status, object_category
LOOKUP-object_category = symantec_ep_change_data_model_fields_lookup vendor_action as Event_Description OUTPUTNEW object_category
LOOKUP-auth_fields = symantec_ep_authentication_fields_lookup description as Event_Description OUTPUTNEW reason

[symantec:ep:policy:file]
TRANSFORMS-nullqueueheader = sep_file_header
KV_MODE = none
pulldown_type = true
category = Network & Security
description = Symantec Endpoint Protection server policy events
MAX_TIMESTAMP_LOOKAHEAD = 32
SHOULD_LINEMERGE = false
EVENT_BREAKER_ENABLE = true

REPORT-field_extraction_for_policy = field_extraction_for_policy,field_extraction_for_policy_1, field_extraction_action, field_extract_event_description, field_extraction_status_2,field_extraction_for_event_content,field_extraction_action_for_event_content,field_extraction_change_type

##### For CIM mapping ######

FIELDALIAS-dest = Server_Name as dest
FIELDALIAS-dvc = Server_Name as dvc
EVAL-object = coalesce(Policy_Name,name)
FIELDALIAS-result = Event_Description as result
FIELDALIAS-user = Admin_Name as user

EVAL-status = if(lower(event_status) IN ("failed", "failure"), "failure", "success")
EVAL-event_action = lower(event_action)
EVAL-vendor_product = "Symantec Endpoint Protection"
EVAL-Policy_Name = nullif(trim(Policy_Name, "\"'"), "")
# Purpose for below "EVAL": trim ' or " or key from field value.
EVAL-Event_Description = nullif(replace(if(match(Event_Description, "\".*"), trim(Event_Description, "\""), if(match(Event_Description, "^\'.*"), trim(Event_Description, "\'"), Event_Description)), "Event Description:\s*", ""), "")

LOOKUP-change_action = symantec_ep_change_action_lookup_340 event_action OUTPUTNEW action
LOOKUP-change_type = symantec_ep_change_data_model_fields_lookup vendor_action as Event_Description OUTPUTNEW change_type
LOOKUP-object_category = symantec_ep_change_data_model_fields_lookup vendor_action as Event_Description OUTPUTNEW object_category
LOOKUP-cim_data_model = symantec_ep_data_model_lookup_340 event_description as Event_Description OUTPUT cim_data_model, dataset


[symantec:ep:policy:syslog]
# Copied field extraction from symantec:ep:policy:file sourcetype
KV_MODE = none
pulldown_type = true
category = Network & Security
description = Symantec Endpoint Protection server policy events

REPORT-field_extraction_for_policy = field_extraction_for_policy, field_extraction_for_policy_1, field_extraction_action, field_extract_event_description,field_extraction_status_2, field_extraction_for_event_content,field_extraction_action_for_event_content,field_extraction_change_type

##### For CIM mapping ######

FIELDALIAS-dest = Server_Name as dest
FIELDALIAS-dvc = Server_Name as dvc
FIELDALIAS-object = Server_Name as object
FIELDALIAS-result = Event_Description as result
FIELDALIAS-user = Admin_Name as user

EVAL-status = if(lower(event_status) IN ("failed", "failure"), "failure", "success")
EVAL-event_action = lower(event_action)
EVAL-vendor_product = "Symantec Endpoint Protection"
EVAL-Policy_Name = nullif(trim(Policy_Name, "\"'"), "")
# Purpose for below "EVAL": trim ' or " or key from field value.
EVAL-Event_Description = nullif(replace(if(match(Event_Description, "\".*"), trim(Event_Description, "\""), if(match(Event_Description, "^\'.*"), trim(Event_Description, "\'"), Event_Description)), "Event Description:\s*", ""), "")
LOOKUP-change_action = symantec_ep_change_action_lookup_340 event_action OUTPUTNEW action
LOOKUP-change_type = symantec_ep_change_data_model_fields_lookup vendor_action as Event_Description OUTPUTNEW change_type
LOOKUP-object_category = symantec_ep_change_data_model_fields_lookup vendor_action as Event_Description OUTPUTNEW object_category
LOOKUP-cim_data_model = symantec_ep_data_model_lookup_340 event_description as Event_Description OUTPUT cim_data_model, dataset


[symantec:ep:packet:file]
TRANSFORMS-nullqueueheader = sep_file_header
KV_MODE = none
pulldown_type = true
category = Network & Security
description = Symantec Endpoint Protection client packet events
MAX_TIMESTAMP_LOOKAHEAD = 32
SHOULD_LINEMERGE = false
EVENT_BREAKER_ENABLE = true

REPORT-field_extraction_for_packet = field_extraction_for_packet

##### For CIM mapping ######

FIELDALIAS-app = Application_Name as app
FIELDALIAS-dvc = Host_Name as dvc

EVAL-direction = lower(Traffic_Direction)
EVAL-dest = if(lower(Traffic_Direction) == "inbound", Local_IP, Remote_IP)
EVAL-src = if(lower(Traffic_Direction) == "outbound", Local_IP, Remote_IP)
EVAL-dest_port = if(lower(Traffic_Direction) =="inbound", Local_Port, Remote_Port)
EVAL-src_port = if(lower(Traffic_Direction) == "outbound", Local_Port, Remote_Port)
EVAL-Host_Name = trim(trim(Host_Name,"\'"),"\"")
EVAL-vendor_product = "Symantec Endpoint Protection"

LOOKUP-intrusion_action = symantec_ep_action_lookup vendor_action as Action OUTPUTNEW action

[symantec:ep:packet:syslog]
# Copied field extraction from symantec:ep:packet:file sourcetype
KV_MODE = none
pulldown_type = true
category = Network & Security
description = Symantec Endpoint Protection client packet events

REPORT-field_extraction_for_packet = field_extraction_for_packet

##### For CIM mapping ######

FIELDALIAS-app = Application_Name as app
FIELDALIAS-dvc = Host_Name as dvc

EVAL-direction = lower(Traffic_Direction)
EVAL-dest = if(lower(Traffic_Direction) == "inbound", Local_IP, Remote_IP)
EVAL-src = if(lower(Traffic_Direction) == "outbound", Local_IP, Remote_IP)
EVAL-dest_port = if(lower(Traffic_Direction) =="inbound", Local_Port, Remote_Port)
EVAL-src_port = if(lower(Traffic_Direction) == "outbound", Local_Port, Remote_Port)
EVAL-Host_Name = trim(trim(Host_Name,"\'"),"\"")
EVAL-vendor_product = "Symantec Endpoint Protection"

LOOKUP-intrusion_action = symantec_ep_action_lookup vendor_action as Action OUTPUTNEW action

[symantec:ep:traffic:file]
TRANSFORMS-nullqueueheader = sep_file_header
KV_MODE = none
pulldown_type = true
category = Network & Security
description = Symantec Endpoint Protection agent traffic events
MAX_TIMESTAMP_LOOKAHEAD = 32
SHOULD_LINEMERGE = false
EVENT_BREAKER_ENABLE = true

REPORT-field_extraction_for_traffic = field_extraction_for_agt_traffic_1, field_extraction_for_agt_traffic_2, filename_from_filepath

##### For CIM mapping ######

FIELDALIAS-SEP_Traffic_Direction = Traffic_Direction as SEP_Traffic_Direction
FIELDALIAS-SEP_traffic_vendor_action = vendor_action as SEP_traffic_vendor_action
FIELDALIAS-file_path = Application_Name as file_path
FIELDALIAS-dvc_from_host_for_sep = Host_Name as dvc
FIELDALIAS-app = Application_Name as app

# For the case: "User Name: user1,user2"
EVAL-user = nullif(split(trim(replace(user, "[^:]+:\s*(.*)", "\1"), "\"'"), ","), "")

# For the case: "Rule: Allow ping, pong and tracert"
EVAL-rule = nullif(trim(replace(rule, "[^:]+:\s*(.*)", "\1"), "\"'"), "")

EVAL-direction = lower(Traffic_Direction)
EVAL-dest_ip = if(Traffic_Direction=="Inbound", Local_Host_IP, Remote_Host_IP)
EVAL-src_ip = if(Traffic_Direction=="Outbound", Local_Host_IP, Remote_Host_IP)
EVAL-dest = if(Traffic_Direction=="Inbound", if(Host_Name=="" OR isnull(Host_Name), Local_Host_IP, trim(trim(Host_Name,"\'"),"\"")), if(Remote_Host_Name=="" OR isnull(Remote_Host_Name), Remote_Host_IP, Remote_Host_Name))
EVAL-src = if(Traffic_Direction=="Outbound", if(Host_Name=="" OR isnull(Host_Name), Local_Host_IP, trim(trim(Host_Name,"\'"),"\"")), if(Remote_Host_Name=="" OR isnull(Remote_Host_Name), Remote_Host_IP, Remote_Host_Name))
EVAL-dest_port = if(Traffic_Direction=="Inbound", Local_Port, Remote_Port)
EVAL-src_port = if(Traffic_Direction=="Outbound", Local_Port, Remote_Port)
EVAL-dest_mac = if(Traffic_Direction=="Outbound", upper(replace(Remote_Host_MAC, "(\w{2})(\w{2})(\w{2})(\w{2})(\w{2})(\w{2})", "\1:\2:\3:\4:\5:\6")), upper(replace(Local_Host_MAC, "(\w{2})(\w{2})(\w{2})(\w{2})(\w{2})(\w{2})", "\1:\2:\3:\4:\5:\6")))
EVAL-src_mac = if(Traffic_Direction=="Inbound", upper(replace(Remote_Host_MAC, "(\w{2})(\w{2})(\w{2})(\w{2})(\w{2})(\w{2})", "\1:\2:\3:\4:\5:\6")), upper(replace(Local_Host_MAC, "(\w{2})(\w{2})(\w{2})(\w{2})(\w{2})(\w{2})", "\1:\2:\3:\4:\5:\6")))
EVAL-protocol = if(Network_Protocol=="ICMP" OR isint(Network_Protocol), "icmp", "ip")
EVAL-transport = if(Network_Protocol=="TCP", "tcp", if(Network_Protocol=="UDP", "udp", if(Network_Protocol=="ICMP", "icmp", "unknown")))
EVAL-duration = strptime(End_Time, "%Y-%m-%d %H:%M:%S")-strptime(Begin_Time, "%Y-%m-%d %H:%M:%S")
EVAL-icmp_type_code = if(isint(Network_Protocol), Network_Protocol, null)
EVAL-Host_Name = trim(trim(Host_Name,"\'"),"\"")
EVAL-vendor_product = "Symantec Endpoint Protection"

LOOKUP-symantec_ep_vendor_action_lookup_for_traffic_file = symantec_ep_action_lookup vendor_action as SEP_traffic_vendor_action OUTPUT action action as SEP_traffic_action
LOOKUP-symantec_ep_severity_lookup_for_traffic_file = symantec_ep_severity_lookup vendor_severity OUTPUT severity
LOOKUP-symantec_ep_icmp_type = symantec_ep_icmp_type_lookup icmp_type_code OUTPUT icmp_type_name

[symantec:ep:traffic:syslog]
# Copied field extraction from symantec:ep:traffic:file sourcetype
KV_MODE = none
pulldown_type = true
category = Network & Security
description = Symantec Endpoint Protection agent traffic events

REPORT-field_extraction_for_traffic = field_extraction_for_agt_traffic_1, field_extraction_for_agt_traffic_2, filename_from_filepath

##### For CIM mapping ######

FIELDALIAS-SEP_Traffic_Direction = Traffic_Direction as SEP_Traffic_Direction
FIELDALIAS-SEP_traffic_vendor_action = vendor_action as SEP_traffic_vendor_action
FIELDALIAS-file_path = Application_Name as file_path
FIELDALIAS-dvc_from_host_for_sep = Host_Name as dvc
FIELDALIAS-app = Application_Name as app

# For the case: "User Name: user1,user2"
EVAL-user = nullif(split(trim(replace(user, "[^:]+:\s*(.*)", "\1"), "\"'"), ","), "")

# For the case: "Rule: Allow ping, pong and tracert"
EVAL-rule = nullif(trim(replace(rule, "[^:]+:\s*(.*)", "\1"), "\"'"), "")

EVAL-direction = lower(Traffic_Direction)
EVAL-dest_ip = if(Traffic_Direction=="Inbound", Local_Host_IP, Remote_Host_IP)
EVAL-src_ip = if(Traffic_Direction=="Outbound", Local_Host_IP, Remote_Host_IP)
EVAL-dest = if(Traffic_Direction=="Inbound", if(Host_Name=="" OR isnull(Host_Name), Local_Host_IP, trim(trim(Host_Name,"\'"),"\"")), if(Remote_Host_Name=="" OR isnull(Remote_Host_Name), Remote_Host_IP, Remote_Host_Name))
EVAL-src = if(Traffic_Direction=="Outbound", if(Host_Name=="" OR isnull(Host_Name), Local_Host_IP, trim(trim(Host_Name,"\'"),"\"")), if(Remote_Host_Name=="" OR isnull(Remote_Host_Name), Remote_Host_IP, Remote_Host_Name))
EVAL-dest_port = if(Traffic_Direction=="Inbound", Local_Port, Remote_Port)
EVAL-src_port = if(Traffic_Direction=="Outbound", Local_Port, Remote_Port)
EVAL-dest_mac = if(Traffic_Direction=="Outbound", upper(replace(Remote_Host_MAC, "(\w{2})(\w{2})(\w{2})(\w{2})(\w{2})(\w{2})", "\1:\2:\3:\4:\5:\6")), upper(replace(Local_Host_MAC, "(\w{2})(\w{2})(\w{2})(\w{2})(\w{2})(\w{2})", "\1:\2:\3:\4:\5:\6")))
EVAL-src_mac = if(Traffic_Direction=="Inbound", upper(replace(Remote_Host_MAC, "(\w{2})(\w{2})(\w{2})(\w{2})(\w{2})(\w{2})", "\1:\2:\3:\4:\5:\6")), upper(replace(Local_Host_MAC, "(\w{2})(\w{2})(\w{2})(\w{2})(\w{2})(\w{2})", "\1:\2:\3:\4:\5:\6")))
EVAL-protocol = if(Network_Protocol=="ICMP" OR isint(Network_Protocol), "icmp", "ip")
EVAL-transport = if(Network_Protocol=="TCP", "tcp", if(Network_Protocol=="UDP", "udp", if(Network_Protocol=="ICMP", "icmp", "unknown")))
EVAL-duration = strptime(End_Time, "%Y-%m-%d %H:%M:%S")-strptime(Begin_Time, "%Y-%m-%d %H:%M:%S")
EVAL-Host_Name = trim(trim(Host_Name,"\'"),"\"")
EVAL-icmp_type_code = if(isint(Network_Protocol), Network_Protocol, null)
EVAL-vendor_product = "Symantec Endpoint Protection"

LOOKUP-symantec_ep_vendor_action_lookup_for_traffic_file = symantec_ep_action_lookup vendor_action as SEP_traffic_vendor_action OUTPUT action action as SEP_traffic_action
LOOKUP-symantec_ep_icmp_type = symantec_ep_icmp_type_lookup icmp_type_code OUTPUT icmp_type_name
